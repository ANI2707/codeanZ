(()=>{class e{constructor(){this.currentCode="",this.currentLanguage="javascript",this.init()}init(){this.detectPlatform(),this.injectAnalyzeButton(),this.observeCodeChanges()}detectPlatform(){const e=window.location.hostname;e.includes("leetcode.com")?(this.platform="leetcode",this.setupLeetCode()):e.includes("hackerrank.com")?(this.platform="hackerrank",this.setupHackerRank()):e.includes("codechef.com")?(this.platform="codechef",this.setupCodeChef()):e.includes("codeforces.com")?(this.platform="codeforces",this.setupCodeforces()):(this.platform="generic",this.setupGeneric())}setupLeetCode(){this.codeSelector=".monaco-editor textarea, .CodeMirror-code",this.languageSelector='[data-cy="lang-select"], .ant-select-selection-selected-value',this.submitButtonSelector='[data-cy="submit-btn"], button[data-e2e-locator="console-submit-button"]'}setupHackerRank(){this.codeSelector=".monaco-editor textarea, .CodeMirror-code",this.languageSelector=".language-selector select",this.submitButtonSelector=".hr-monaco-submit"}setupCodeChef(){this.codeSelector=".CodeMirror-code, .monaco-editor textarea",this.languageSelector="#edit_solution_language",this.submitButtonSelector="#edit_solution_submit"}setupCodeforces(){this.codeSelector=".CodeMirror-code, #sourceCodeTextarea",this.languageSelector='select[name="programTypeId"]',this.submitButtonSelector=".submit"}setupGeneric(){this.codeSelector="textarea, .CodeMirror-code, .monaco-editor textarea",this.languageSelector="select",this.submitButtonSelector="button"}injectAnalyzeButton(){const e=document.createElement("button");e.id="dsa-analyzer-btn",e.innerHTML='\n      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M3 3v18h18"/>\n        <path d="M7 12h10"/>\n        <path d="M7 8h7"/>\n        <path d="M7 16h6"/>\n      </svg>\n      Analyze Complexity\n    ',e.className="dsa-analyzer-button",e.addEventListener("click",()=>this.openAnalyzer());let t=this.findButtonContainer();t&&t.appendChild(e)}findButtonContainer(){const e=[".action-btn-set",".hr-monaco-toolbar",".ide-bottom-bar",".submit-wrapper",".toolbar",".controls","body"];for(const t of e){const e=document.querySelector(t);if(e)return e}return document.body}observeCodeChanges(){const e=new MutationObserver(()=>{this.updateCurrentCode()}),t=document.querySelector(this.codeSelector);t&&e.observe(t,{childList:!0,subtree:!0,characterData:!0})}updateCurrentCode(){const e=document.querySelector(this.codeSelector);e&&("TEXTAREA"===e.tagName?this.currentCode=e.value:this.currentCode=e.textContent||"");const t=document.querySelector(this.languageSelector);t&&(this.currentLanguage=this.parseLanguage(t.value||t.textContent))}parseLanguage(e){return{javascript:"javascript",python:"python",python3:"python",java:"java",cpp:"cpp","c++":"cpp",c:"c",go:"go",rust:"rust"}[e.toLowerCase().trim()]||"javascript"}openAnalyzer(){this.updateCurrentCode(),chrome.runtime.sendMessage({action:"analyze",code:this.currentCode,language:this.currentLanguage,platform:this.platform,url:window.location.href}),this.createFloatingAnalyzer()}createFloatingAnalyzer(){const e=document.getElementById("dsa-analyzer-float");e&&e.remove();const t=document.createElement("div");t.id="dsa-analyzer-float",t.className="dsa-analyzer-floating",t.innerHTML='\n      <div class="dsa-analyzer-header">\n        <h3>DSA Complexity Analyzer</h3>\n        <button class="dsa-analyzer-close">&times;</button>\n      </div>\n      <div class="dsa-analyzer-content">\n        <div class="dsa-analyzer-loading">\n          <div class="spinner"></div>\n          <p>Analyzing complexity...</p>\n        </div>\n      </div>\n    ',document.body.appendChild(t),t.querySelector(".dsa-analyzer-close").addEventListener("click",()=>{t.remove()}),this.makeDraggable(t),this.performAnalysis(t)}makeDraggable(e){let t=0,n=0,o=0,a=0;function s(s){(s=s||window.event).preventDefault(),t=o-s.clientX,n=a-s.clientY,o=s.clientX,a=s.clientY,e.style.top=e.offsetTop-n+"px",e.style.left=e.offsetLeft-t+"px"}function i(){document.onmouseup=null,document.onmousemove=null}e.querySelector(".dsa-analyzer-header").onmousedown=function(e){(e=e||window.event).preventDefault(),o=e.clientX,a=e.clientY,document.onmouseup=i,document.onmousemove=s}}async performAnalysis(e){try{const t=(await chrome.storage.sync.get(["dsa_analyzer_api_key"])).dsa_analyzer_api_key;if(!t)throw new Error("API key not configured. Please set it in the extension popup.");const n=await fetch(chrome.runtime.getURL("popup/api-proxy.html"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:this.currentCode,language:this.currentLanguage,apiKey:t})}),o=await n.json();this.displayResults(e,o)}catch(t){this.displayError(e,t.message)}}displayResults(e,t){const n=e.querySelector(".dsa-analyzer-content");n.innerHTML=`\n      <div class="analysis-results">\n        <div class="complexity-section">\n          <h4>Time Complexity</h4>\n          <div class="complexity-badge">${t.timeComplexity.bigO}</div>\n          <p class="complexity-explanation">${t.timeComplexity.explanation}</p>\n        </div>\n        \n        <div class="complexity-section">\n          <h4>Space Complexity</h4>\n          <div class="complexity-badge">${t.spaceComplexity.bigO}</div>\n          <p class="complexity-explanation">${t.spaceComplexity.explanation}</p>\n        </div>\n\n        ${t.suggestions.length>0?`\n          <div class="suggestions-section">\n            <h4>Optimization Suggestions</h4>\n            <ul>\n              ${t.suggestions.map(e=>`<li>${e}</li>`).join("")}\n            </ul>\n          </div>\n        `:""}\n\n        <div class="actions">\n          <button class="btn-primary" id="view-details">View Detailed Analysis</button>\n        </div>\n      </div>\n    `,n.querySelector("#view-details").addEventListener("click",()=>{window.open(chrome.runtime.getURL("popup/detailed.html")+`?data=${encodeURIComponent(JSON.stringify(t))}`)})}displayError(e,t){e.querySelector(".dsa-analyzer-content").innerHTML=`\n      <div class="error-message">\n        <h4>Analysis Failed</h4>\n        <p>${t}</p>\n        <button class="btn-secondary" onclick="this.closest('#dsa-analyzer-float').remove()">Close</button>\n      </div>\n    `}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>new e):new e})();